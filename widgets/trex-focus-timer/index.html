<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="robots" content="noindex" />
  <title>T-Rex Focus Timer</title>
  <style>
    :root{
      --bg:#ffffff;
      --ink:#111827;
      --muted:#6b7280;
      --card:#f8fafc;
      --line:#e5e7eb;
      --accent:#16a34a;
      --shadow: 0 6px 20px rgba(0,0,0,.06);
      --radius:18px;
      --font: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Sans", "Noto Sans JP", "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:var(--font);
      color:var(--ink);
      background:transparent; /* Notion iframeæƒ³å®š */
    }

    .wrap{
      width:100%;
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:14px;
    }

    .card{
      width:min(760px, 100%);
      background:var(--bg);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
    }

    .top{
      display:flex;
      gap:14px;
      align-items:stretch;
      justify-content:space-between;
      flex-wrap:wrap;
    }

    .pixelBox{
      flex: 0 0 210px;
      display:flex;
      align-items:center;
      justify-content:center;
      background:var(--card);
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px;
    }

    canvas{
      width:170px;
      height:170px;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      border-radius:10px;
      background:#fff;
    }

    .info{
      flex: 1 1 320px;
      min-width:260px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .titleRow{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    .title{
      font-size:14px;
      font-weight:700;
      letter-spacing:.02em;
    }

    .stage{
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
    }

    .time{
      font-size:40px;
      font-weight:800;
      letter-spacing:.04em;
      line-height:1;
    }

    .sub{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      color:var(--muted);
      font-size:12px;
    }

    .bar{
      width:100%;
      height:10px;
      background:var(--card);
      border:1px solid var(--line);
      border-radius:999px;
      overflow:hidden;
    }

    .bar > i{
      display:block;
      height:100%;
      width:0%;
      background:var(--accent);
    }

    .controls{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
      margin-top:2px;
    }

    button{
      appearance:none;
      border:1px solid var(--line);
      background:#fff;
      color:var(--ink);
      border-radius:12px;
      padding:10px 12px;
      font-weight:700;
      font-size:13px;
      cursor:pointer;
      transition: transform .05s ease, background .15s ease;
    }
    button:active{ transform: translateY(1px); }
    button.primary{
      border-color: rgba(22,163,74,.35);
      background: rgba(22,163,74,.10);
    }
    button.danger{
      border-color: rgba(239,68,68,.35);
      background: rgba(239,68,68,.08);
    }

    .mini{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
      color:var(--muted);
      font-size:12px;
    }

    input[type="number"]{
      width:88px;
      padding:10px 10px;
      border-radius:12px;
      border:1px solid var(--line);
      background:#fff;
      font-weight:700;
      font-size:13px;
      color:var(--ink);
      outline:none;
    }

    .foot{
      margin-top:10px;
      border-top:1px dashed var(--line);
      padding-top:10px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      font-size:11px;
      color:var(--muted);
    }

    .kbd{
      border:1px solid var(--line);
      background:#fff;
      border-radius:8px;
      padding:2px 6px;
      font-weight:700;
      color:var(--ink);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card" role="application" aria-label="T-Rex Focus Timer">
      <div class="top">
        <div class="pixelBox">
          <canvas id="px" width="48" height="48" aria-label="pixel art"></canvas>
        </div>

        <div class="info">
          <div class="titleRow">
            <div class="title">ğŸ¦– é›†ä¸­ã‚¿ã‚¤ãƒãƒ¼ï¼ˆãƒ‰ãƒƒãƒˆçµµï¼‰</div>
            <div class="stage" id="stageText">0ã€œ5åˆ†ï¼šæç«œã®åµ</div>
          </div>

          <div class="time" id="timeText">30:00</div>

          <div class="sub">
            <div>çµŒéï¼š<span id="elapsedText">0:00</span></div>
            <div>è¨­å®šï¼š<span id="setText">30</span> åˆ†</div>
          </div>

          <div class="bar" aria-label="progress">
            <i id="barFill"></i>
          </div>

          <div class="controls">
            <button id="startBtn" class="primary">â–¶ï¸ Start</button>
            <button id="pauseBtn">â¸ Pause</button>
            <button id="resetBtn" class="danger">â†º Reset</button>

            <div class="mini" style="margin-left:auto">
              <label for="mins">åˆ†ï¼š</label>
              <input id="mins" type="number" min="1" max="30" step="1" value="30" />
              <button id="applyBtn">é©ç”¨</button>
            </div>
          </div>

          <div class="foot">
            <div>ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆï¼š<span class="kbd">Space</span> Start/Pauseã€€<span class="kbd">R</span> Reset</div>
            <div>â€» 5åˆ†ã”ã¨ã«ãƒ‰ãƒƒãƒˆçµµãŒé€²åŒ–ï¼ˆæœ€å¤§30åˆ†ï¼‰</div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  // ---------- Utilities ----------
  const $ = (id) => document.getElementById(id);

  const stageDefs = [
    { label: "0ã€œ5åˆ†ï¼šæç«œã®åµ" },
    { label: "6ã€œ10åˆ†ï¼šåµã«ãƒ’ãƒ“ãŒå…¥ã‚‹" },
    { label: "11ã€œ15åˆ†ï¼šèµ¤ã¡ã‚ƒã‚“ãŒé¡”ã‚’å‡ºã™" },
    { label: "16ã€œ20åˆ†ï¼šæ®»ã‹ã‚‰å‡ºã¦ãã‚‹" },
    { label: "21ã€œ25åˆ†ï¼šã‚¬ã‚ªãƒ¼ã¨å ãˆã‚‹" },
    { label: "26ã€œ30åˆ†ï¼šåµã‚’ç”£ã‚€" }
  ];

  function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

  function mmss(seconds){
    seconds = Math.max(0, Math.floor(seconds));
    const m = Math.floor(seconds / 60);
    const s = seconds % 60;
    return `${m}:${String(s).padStart(2,'0')}`;
  }

  // ---------- Timer State ----------
  const canvas = $("px");
  const ctx = canvas.getContext("2d", { alpha: false });

  let totalMinutes = 30;
  let totalSec = totalMinutes * 60;

  let running = false;
  let startTs = 0;         // performance.now() at start
  let elapsedAcc = 0;      // accumulated elapsed seconds when paused
  let tickHandle = null;

  // ---------- Pixel Art Renderer ----------
  // 48x48 canvas, draw in "pixel blocks" (1 unit = 1px in canvas)
  function clear(bg="#ffffff"){
    ctx.fillStyle = bg;
    ctx.fillRect(0,0,canvas.width,canvas.height);
  }

  function px(x,y,w,h,color){
    ctx.fillStyle = color;
    ctx.fillRect(x,y,w,h);
  }

  function outlineRect(x,y,w,h,color){
    ctx.strokeStyle = color;
    ctx.lineWidth = 1;
    ctx.strokeRect(x+0.5,y+0.5,w-1,h-1);
  }

  // Simple T-Rex palette (pixel-style)
  const C = {
    eggA: "#e7d9c8",
    eggB: "#d7c6b1",
    eggLine:"#6b5b4b",
    crack:"#2f2a25",
    baby:"#63b36f",      // baby green
    trex:"#2f8f5a",      // adult green
    trexDark:"#1f6f45",
    blush:"#f59e9e",
    white:"#ffffff",
    shadow:"#cbd5e1",
    mouth:"#ef4444",
    tooth:"#f8fafc",
    eye:"#111827",
    ground:"#eef2f7"
  };

  function drawGround(){
    px(0, 40, 48, 8, C.ground);
    // small pebbles
    px(6, 44, 2, 1, C.shadow);
    px(16, 45, 1, 1, C.shadow);
    px(33, 44, 2, 1, C.shadow);
    px(41, 46, 1, 1, C.shadow);
  }

  function drawEggBase(cracked=false){
    // egg body (centered)
    const x=14, y=10, w=20, h=28;
    // shadow
    px(x+3, y+h-1, w-6, 2, C.shadow);

    // egg fill (two-tone)
    px(x, y+2, w, h-2, C.eggA);
    px(x, y+6, w, h-8, C.eggB);

    // rounded top
    px(x+2, y, w-4, 2, C.eggA);
    px(x+4, y-1, w-8, 1, C.eggA);

    // outline
    outlineRect(x, y, w, h, C.eggLine);

    // speckles
    px(x+4, y+12, 2, 2, C.eggLine);
    px(x+12, y+18, 1, 1, C.eggLine);
    px(x+15, y+10, 2, 1, C.eggLine);
    px(x+7, y+20, 1, 2, C.eggLine);

    if(cracked){
      // crack lines
      px(x+9, y+10, 1, 6, C.crack);
      px(x+10, y+14, 2, 1, C.crack);
      px(x+12, y+15, 1, 2, C.crack);
      px(x+8, y+16, 1, 2, C.crack);
      px(x+7, y+18, 3, 1, C.crack);
    }
  }

  function drawStage0(){
    clear();
    drawEggBase(false);
    drawGround();
  }

  function drawStage1(){
    clear();
    drawEggBase(true);
    // extra crack
    px(26, 22, 1, 6, C.crack);
    px(24, 24, 2, 1, C.crack);
    drawGround();
  }

  function drawStage2(){
    clear();
    // egg bottom + opening
    // bottom shell
    drawEggBase(true);
    // "hole"
    px(20, 16, 8, 6, C.white);
    // baby face peeking
    px(22, 17, 4, 3, C.baby);
    px(23, 18, 1, 1, C.eye);
    px(25, 18, 1, 1, C.eye);
    px(24, 19, 1, 1, C.blush);
    // tiny mouth
    px(24, 20, 2, 1, C.mouth);

    // shell chips
    px(19, 15, 1, 2, C.eggLine);
    px(28, 16, 1, 2, C.eggLine);
    drawGround();
  }

  function drawStage3(){
    clear();
    // broken egg halves + baby out
    // left shell
    px(12, 20, 10, 12, C.eggA); outlineRect(12,20,10,12,C.eggLine);
    px(12, 20, 10, 3, C.eggB);
    // right shell
    px(26, 20, 10, 12, C.eggA); outlineRect(26,20,10,12,C.eggLine);
    px(26, 20, 10, 3, C.eggB);

    // baby T-Rex body
    px(20, 16, 8, 10, C.baby); outlineRect(20,16,8,10,C.trexDark);
    // head
    px(19, 12, 10, 6, C.baby); outlineRect(19,12,10,6,C.trexDark);
    // eye
    px(21, 14, 1, 1, C.eye);
    // tail
    px(28, 20, 6, 3, C.baby);
    px(32, 21, 4, 2, C.baby);
    // arm
    px(18, 19, 2, 2, C.baby);
    // feet
    px(21, 26, 2, 2, C.trexDark);
    px(25, 26, 2, 2, C.trexDark);

    drawGround();
  }

  function drawStage4(){
    clear();
    // adult-ish T-Rex roaring
    // body
    px(16, 20, 14, 14, C.trex); outlineRect(16,20,14,14,C.trexDark);
    // head (bigger)
    px(14, 12, 18, 10, C.trex); outlineRect(14,12,18,10,C.trexDark);

    // open mouth
    px(28, 16, 6, 4, C.mouth);
    outlineRect(28,16,6,4,C.trexDark);
    // teeth
    px(29, 16, 1, 1, C.tooth);
    px(31, 16, 1, 1, C.tooth);
    px(33, 16, 1, 1, C.tooth);
    px(29, 19, 1, 1, C.tooth);
    px(31, 19, 1, 1, C.tooth);
    px(33, 19, 1, 1, C.tooth);

    // eye
    px(18, 15, 2, 2, C.eye);
    // legs
    px(18, 34, 4, 4, C.trexDark);
    px(26, 34, 4, 4, C.trexDark);
    // tail
    px(30, 26, 10, 4, C.trex);
    px(38, 27, 8, 3, C.trex);
    // small arms
    px(14, 24, 3, 3, C.trexDark);

    // roar marks
    px(40, 10, 2, 2, C.mouth);
    px(42, 8, 2, 2, C.mouth);
    px(44, 10, 2, 2, C.mouth);

    drawGround();
  }

  function drawStage5(){
    clear();
    // adult T-Rex + egg
    // body
    px(14, 18, 18, 18, C.trex); outlineRect(14,18,18,18,C.trexDark);
    // head
    px(12, 10, 18, 10, C.trex); outlineRect(12,10,18,10,C.trexDark);
    // eye
    px(16, 13, 2, 2, C.eye);
    // tail
    px(30, 24, 14, 5, C.trex);
    px(42, 25, 6, 4, C.trex);
    // legs
    px(16, 36, 5, 4, C.trexDark);
    px(25, 36, 5, 4, C.trexDark);

    // egg being laid (cute)
    px(34, 30, 10, 12, C.eggA); outlineRect(34,30,10,12,C.eggLine);
    px(35, 33, 8, 6, C.eggB);
    px(37, 36, 2, 2, C.eggLine);

    // sparkles
    px(8, 8, 2, 2, C.accent || "#16a34a");
    px(6, 10, 1, 1, C.accent || "#16a34a");
    px(10, 10, 1, 1, C.accent || "#16a34a");

    drawGround();
  }

  function renderStage(stageIndex){
    const s = clamp(stageIndex, 0, 5);
    const drawers = [drawStage0, drawStage1, drawStage2, drawStage3, drawStage4, drawStage5];
    drawers[s]();
    $("stageText").textContent = stageDefs[s].label;
  }

  // ---------- Core Logic ----------
  function getElapsedSec(){
    if(!running) return elapsedAcc;
    const now = performance.now();
    return elapsedAcc + (now - startTs) / 1000;
  }

  function setTotalMinutes(m){
    totalMinutes = clamp(m, 1, 30);
    totalSec = totalMinutes * 60;
    $("setText").textContent = String(totalMinutes);
    $("mins").value = String(totalMinutes);
  }

  function updateUI(){
    const elapsed = getElapsedSec();
    const remaining = totalSec - elapsed;

    $("elapsedText").textContent = mmss(elapsed);
    $("timeText").textContent = mmss(remaining);

    const pct = clamp((elapsed / totalSec) * 100, 0, 100);
    $("barFill").style.width = pct.toFixed(2) + "%";

    // stage changes every 5 minutes elapsed, based on "absolute elapsed minutes"
    // Mapping: 0-5 => 0, 6-10 => 1, 11-15 => 2, ...
    const elapsedMin = Math.floor(elapsed / 60);
    let stage = Math.floor(elapsedMin / 5);
    stage = clamp(stage, 0, 5);

    // Ensure we respect the spec boundaries for "0ã€œ5" / "6ã€œ10" etc:
    // At exactly 5:00 elapsed, still stage 0; switch at 6:00 elapsed.
    // Our formula switches at 5:00-> stage1 if elapsedMin is 5. So adjust:
    // stage should be 0 when elapsedMin <= 5.
    if (elapsedMin <= 5) stage = 0;
    else if (elapsedMin <= 10) stage = 1;
    else if (elapsedMin <= 15) stage = 2;
    else if (elapsedMin <= 20) stage = 3;
    else if (elapsedMin <= 25) stage = 4;
    else stage = 5;

    renderStage(stage);

    if(remaining <= 0){
      finish();
    }
  }

  function start(){
    if(running) return;
    running = true;
    startTs = performance.now();
    $("startBtn").textContent = "â–¶ï¸ Running";
    tickHandle = setInterval(updateUI, 200);
    updateUI();
  }

  function pause(){
    if(!running) return;
    running = false;
    elapsedAcc = getElapsedSec();
    clearInterval(tickHandle);
    tickHandle = null;
    $("startBtn").textContent = "â–¶ï¸ Start";
    updateUI();
  }

  function reset(){
    running = false;
    clearInterval(tickHandle);
    tickHandle = null;
    elapsedAcc = 0;
    $("startBtn").textContent = "â–¶ï¸ Start";
    $("barFill").style.width = "0%";
    renderStage(0);
    $("elapsedText").textContent = "0:00";
    $("timeText").textContent = mmss(totalSec);
  }

  function finish(){
    // stop at 0
    running = false;
    clearInterval(tickHandle);
    tickHandle = null;
    elapsedAcc = totalSec;
    updateUI();
    $("startBtn").textContent = "âœ… Done";
  }

  // ---------- Events ----------
  $("startBtn").addEventListener("click", () => {
    if(running) return;
    if(elapsedAcc >= totalSec) reset();
    start();
  });

  $("pauseBtn").addEventListener("click", () => {
    if(running) pause();
    else start();
  });

  $("resetBtn").addEventListener("click", reset);

  $("applyBtn").addEventListener("click", () => {
    const v = Number($("mins").value || 30);
    setTotalMinutes(v);
    reset();
  });

  // keyboard
  window.addEventListener("keydown", (e) => {
    if(e.code === "Space"){
      e.preventDefault();
      if(running) pause(); else start();
    }
    if(e.key.toLowerCase() === "r"){
      reset();
    }
  });

  // ---------- Init ----------
  setTotalMinutes(30);
  reset();
})();
</script>
</body>
</html>
