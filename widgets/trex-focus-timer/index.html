<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="robots" content="noindex" />
  <title>T-Rex Focus Timer</title>
  <style>
    :root{
      --bg:#ffffff;
      --ink:#111827;
      --muted:#6b7280;
      --card:#f8fafc;
      --line:#e5e7eb;
      --accent:#16a34a;
      --shadow: 0 6px 20px rgba(0,0,0,.06);
      --radius:18px;
      --font: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Sans", "Noto Sans JP", "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:var(--font);
      color:var(--ink);
      background:transparent;
    }
    .wrap{
      width:100%;
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:14px;
    }
    .card{
      width:min(760px, 100%);
      background:var(--bg);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
    }
    .top{
      display:flex;
      gap:14px;
      align-items:stretch;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .pixelBox{
      flex: 0 0 210px;
      display:flex;
      align-items:center;
      justify-content:center;
      background:var(--card);
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px;
    }
    canvas{
      width:170px;
      height:170px;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      border-radius:10px;
      background:#fff;
    }
    .info{
      flex: 1 1 320px;
      min-width:260px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .titleRow{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .title{
      font-size:14px;
      font-weight:700;
      letter-spacing:.02em;
    }
    .stage{
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
    }
    .time{
      font-size:40px;
      font-weight:800;
      letter-spacing:.04em;
      line-height:1;
    }
    .sub{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      color:var(--muted);
      font-size:12px;
    }
    .bar{
      width:100%;
      height:10px;
      background:var(--card);
      border:1px solid var(--line);
      border-radius:999px;
      overflow:hidden;
    }
    .bar > i{
      display:block;
      height:100%;
      width:0%;
      background:var(--accent);
    }
    .controls{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
      margin-top:2px;
    }
    button{
      appearance:none;
      border:1px solid var(--line);
      background:#fff;
      color:var(--ink);
      border-radius:12px;
      padding:10px 12px;
      font-weight:700;
      font-size:13px;
      cursor:pointer;
      transition: transform .05s ease, background .15s ease;
    }
    button:active{ transform: translateY(1px); }
    button.primary{
      border-color: rgba(22,163,74,.35);
      background: rgba(22,163,74,.10);
    }
    button.danger{
      border-color: rgba(239,68,68,.35);
      background: rgba(239,68,68,.08);
    }
    .mini{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
      color:var(--muted);
      font-size:12px;
    }
    input[type="number"]{
      width:96px;
      padding:10px 10px;
      border-radius:12px;
      border:1px solid var(--line);
      background:#fff;
      font-weight:700;
      font-size:13px;
      color:var(--ink);
      outline:none;
    }
    .foot{
      margin-top:10px;
      border-top:1px dashed var(--line);
      padding-top:10px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      font-size:11px;
      color:var(--muted);
    }
    .kbd{
      border:1px solid var(--line);
      background:#fff;
      border-radius:8px;
      padding:2px 6px;
      font-weight:700;
      color:var(--ink);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card" role="application" aria-label="T-Rex Focus Timer">
      <div class="top">
        <div class="pixelBox">
          <canvas id="px" width="48" height="48" aria-label="pixel art"></canvas>
        </div>

        <div class="info">
          <div class="titleRow">
            <div class="title">ğŸ¦– é›†ä¸­ã‚¿ã‚¤ãƒãƒ¼ï¼ˆãƒ‰ãƒƒãƒˆçµµï¼‰</div>
            <div class="stage" id="stageText">ã‚¹ãƒ†ãƒ¼ã‚¸ 1/6</div>
          </div>

          <div class="time" id="timeText">30:00</div>

          <div class="sub">
            <div>çµŒéï¼š<span id="elapsedText">0:00</span></div>
            <div>è¨­å®šï¼š<span id="setText">30</span> åˆ†ï¼å¤‰åŒ–ï¼š<span id="stepText">5åˆ†</span>ã”ã¨</div>
          </div>

          <div class="bar" aria-label="progress">
            <i id="barFill"></i>
          </div>

          <div class="controls">
            <button id="startBtn" class="primary">â–¶ï¸ Start</button>
            <button id="pauseBtn">â¸ Pause</button>
            <button id="resetBtn" class="danger">â†º Reset</button>

            <div class="mini" style="margin-left:auto">
              <label for="mins">åˆ†ï¼š</label>
              <input id="mins" type="number" min="1" max="180" step="1" value="30" />
              <button id="applyBtn">é©ç”¨</button>
            </div>
          </div>

          <div class="foot">
            <div>ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆï¼š<span class="kbd">Space</span> Start/Pauseã€€<span class="kbd">R</span> Reset</div>
            <div>â€» è¨­å®šæ™‚é–“ã‚’6åˆ†å‰²ã—ã¦ã€é †ç•ªã«é€²åŒ–ã—ã¾ã™</div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);
  const canvas = $("px");
  const ctx = canvas.getContext("2d", { alpha: false });

  // 6 stages (0..5)
  const stageLabels = [
    "æç«œã®åµ",
    "åµã«ãƒ’ãƒ“",
    "èµ¤ã¡ã‚ƒã‚“ãŒé¡”ã‚’å‡ºã™",
    "æ®»ã‹ã‚‰å‡ºã¦ãã‚‹",
    "ã‚¬ã‚ªãƒ¼ï¼",
    "åµã‚’ç”£ã‚€"
  ];

  function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

  function mmss(seconds){
    seconds = Math.max(0, Math.floor(seconds));
    const m = Math.floor(seconds / 60);
    const s = seconds % 60;
    return `${m}:${String(s).padStart(2,'0')}`;
  }

  // stepè¡¨ç¤ºç”¨ï¼ˆç§’â†’"10ç§’" or "5åˆ†" or "1åˆ†30ç§’"ï¼‰
  function humanStep(sec){
    sec = Math.max(1, Math.round(sec));
    const m = Math.floor(sec / 60);
    const s = sec % 60;
    if (m === 0) return `${s}ç§’`;
    if (s === 0) return `${m}åˆ†`;
    return `${m}åˆ†${s}ç§’`;
  }

  // ---------- Timer State ----------
  let totalMinutes = 30;
  let totalSec = totalMinutes * 60;

  let running = false;
  let startTs = 0;
  let elapsedAcc = 0;
  let tickHandle = null;

  // ã€Œè¨­å®šæ™‚é–“Ã·6ã€ãŒ1ã‚¹ãƒ†ãƒƒãƒ—ã®é•·ã•
  function stepSec(){
    // 6æšã‚ã‚‹ã®ã§ã€å…¨ä½“ã‚’6åˆ†å‰²
    // ãŸã ã—æ¥µç«¯ã«çŸ­ã„è¨­å®šã§ã‚‚ã‚¼ãƒ­å‰²ã«ãªã‚‰ãªã„ã‚ˆã†æœ€ä½1ç§’
    return Math.max(1, totalSec / 6);
  }

  // ---------- Pixel Art Palette ----------
  const C = {
    eggA: "#e7d9c8",
    eggB: "#d7c6b1",
    eggLine:"#6b5b4b",
    crack:"#2f2a25",
    baby:"#63b36f",
    trex:"#2f8f5a",
    trexDark:"#1f6f45",
    blush:"#f59e9e",
    white:"#ffffff",
    shadow:"#cbd5e1",
    mouth:"#ef4444",
    tooth:"#f8fafc",
    eye:"#111827",
    ground:"#eef2f7",
    accent:"#16a34a"
  };

  function clear(bg="#ffffff"){
    ctx.fillStyle = bg;
    ctx.fillRect(0,0,canvas.width,canvas.height);
  }
  function px(x,y,w,h,color){
    ctx.fillStyle = color;
    ctx.fillRect(x,y,w,h);
  }
  function outlineRect(x,y,w,h,color){
    ctx.strokeStyle = color;
    ctx.lineWidth = 1;
    ctx.strokeRect(x+0.5,y+0.5,w-1,h-1);
  }
  function drawGround(){
    px(0, 40, 48, 8, C.ground);
    px(6, 44, 2, 1, C.shadow);
    px(16, 45, 1, 1, C.shadow);
    px(33, 44, 2, 1, C.shadow);
    px(41, 46, 1, 1, C.shadow);
  }

  function drawEggBase(cracked=false){
    const x=14, y=10, w=20, h=28;
    px(x+3, y+h-1, w-6, 2, C.shadow);

    px(x, y+2, w, h-2, C.eggA);
    px(x, y+6, w, h-8, C.eggB);

    px(x+2, y, w-4, 2, C.eggA);
    px(x+4, y-1, w-8, 1, C.eggA);

    outlineRect(x, y, w, h, C.eggLine);

    px(x+4, y+12, 2, 2, C.eggLine);
    px(x+12, y+18, 1, 1, C.eggLine);
    px(x+15, y+10, 2, 1, C.eggLine);
    px(x+7, y+20, 1, 2, C.eggLine);

    if(cracked){
      px(x+9, y+10, 1, 6, C.crack);
      px(x+10, y+14, 2, 1, C.crack);
      px(x+12, y+15, 1, 2, C.crack);
      px(x+8, y+16, 1, 2, C.crack);
      px(x+7, y+18, 3, 1, C.crack);
    }
  }

  function drawStage0(){ clear(); drawEggBase(false); drawGround(); }
  function drawStage1(){
    clear();
    drawEggBase(true);
    px(26, 22, 1, 6, C.crack);
    px(24, 24, 2, 1, C.crack);
    drawGround();
  }
  function drawStage2(){
    clear();
    drawEggBase(true);
    px(20, 16, 8, 6, C.white);
    px(22, 17, 4, 3, C.baby);
    px(23, 18, 1, 1, C.eye);
    px(25, 18, 1, 1, C.eye);
    px(24, 19, 1, 1, C.blush);
    px(24, 20, 2, 1, C.mouth);
    px(19, 15, 1, 2, C.eggLine);
    px(28, 16, 1, 2, C.eggLine);
    drawGround();
  }
  function drawStage3(){
    clear();
    px(12, 20, 10, 12, C.eggA); outlineRect(12,20,10,12,C.eggLine);
    px(12, 20, 10, 3, C.eggB);
    px(26, 20, 10, 12, C.eggA); outlineRect(26,20,10,12,C.eggLine);
    px(26, 20, 10, 3, C.eggB);

    px(20, 16, 8, 10, C.baby); outlineRect(20,16,8,10,C.trexDark);
    px(19, 12, 10, 6, C.baby); outlineRect(19,12,10,6,C.trexDark);
    px(21, 14, 1, 1, C.eye);
    px(28, 20, 6, 3, C.baby);
    px(32, 21, 4, 2, C.baby);
    px(18, 19, 2, 2, C.baby);
    px(21, 26, 2, 2, C.trexDark);
    px(25, 26, 2, 2, C.trexDark);
    drawGround();
  }
  function drawStage4(){
    clear();
    px(16, 20, 14, 14, C.trex); outlineRect(16,20,14,14,C.trexDark);
    px(14, 12, 18, 10, C.trex); outlineRect(14,12,18,10,C.trexDark);

    px(28, 16, 6, 4, C.mouth); outlineRect(28,16,6,4,C.trexDark);
    px(29, 16, 1, 1, C.tooth);
    px(31, 16, 1, 1, C.tooth);
    px(33, 16, 1, 1, C.tooth);
    px(29, 19, 1, 1, C.tooth);
    px(31, 19, 1, 1, C.tooth);
    px(33, 19, 1, 1, C.tooth);

    px(18, 15, 2, 2, C.eye);
    px(18, 34, 4, 4, C.trexDark);
    px(26, 34, 4, 4, C.trexDark);

    px(30, 26, 10, 4, C.trex);
    px(38, 27, 8, 3, C.trex);

    px(14, 24, 3, 3, C.trexDark);

    px(40, 10, 2, 2, C.mouth);
    px(42, 8, 2, 2, C.mouth);
    px(44, 10, 2, 2, C.mouth);

    drawGround();
  }
  function drawStage5(){
    clear();
    px(14, 18, 18, 18, C.trex); outlineRect(14,18,18,18,C.trexDark);
    px(12, 10, 18, 10, C.trex); outlineRect(12,10,18,10,C.trexDark);
    px(16, 13, 2, 2, C.eye);

    px(30, 24, 14, 5, C.trex);
    px(42, 25, 6, 4, C.trex);

    px(16, 36, 5, 4, C.trexDark);
    px(25, 36, 5, 4, C.trexDark);

    px(34, 30, 10, 12, C.eggA); outlineRect(34,30,10,12,C.eggLine);
    px(35, 33, 8, 6, C.eggB);
    px(37, 36, 2, 2, C.eggLine);

    px(8, 8, 2, 2, C.accent);
    px(6, 10, 1, 1, C.accent);
    px(10, 10, 1, 1, C.accent);

    drawGround();
  }

  function renderStage(stageIndex){
    const s = clamp(stageIndex, 0, 5);
    const drawers = [drawStage0, drawStage1, drawStage2, drawStage3, drawStage4, drawStage5];
    drawers[s]();

    // è¡¨ç¤ºï¼šã‚¹ãƒ†ãƒ¼ã‚¸n/6 + ãƒ©ãƒ™ãƒ«
    $("stageText").textContent = `ã‚¹ãƒ†ãƒ¼ã‚¸ ${s+1}/6ï¼š${stageLabels[s]}`;
  }

  // ---------- Core Logic ----------
  function getElapsedSec(){
    if(!running) return elapsedAcc;
    const now = performance.now();
    return elapsedAcc + (now - startTs) / 1000;
  }

  function setTotalMinutes(m){
    totalMinutes = clamp(m, 1, 180);
    totalSec = totalMinutes * 60;

    $("setText").textContent = String(totalMinutes);
    $("mins").value = String(totalMinutes);

    // å¤‰åŒ–é–“éš”è¡¨ç¤º
    $("stepText").textContent = humanStep(stepSec());
  }

  function updateUI(){
    const elapsed = getElapsedSec();
    const remaining = totalSec - elapsed;

    $("elapsedText").textContent = mmss(elapsed);
    $("timeText").textContent = mmss(remaining);

    const pct = clamp((elapsed / totalSec) * 100, 0, 100);
    $("barFill").style.width = pct.toFixed(2) + "%";

    // â˜…ã“ã“ãŒãƒã‚¤ãƒ³ãƒˆï¼šè¨­å®šæ™‚é–“ã‚’6åˆ†å‰²ã—ã¦ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’æ±ºã‚ã‚‹
    const s = stepSec();                 // 1ã‚¹ãƒ†ãƒƒãƒ—ã®ç§’æ•°
    let stage = Math.floor(elapsed / s); // 0..5..(ãã‚Œä»¥ä¸Š)
    stage = clamp(stage, 0, 5);

    renderStage(stage);

    if(remaining <= 0){
      finish();
    }
  }

  function start(){
    if(running) return;
    running = true;
    startTs = performance.now();
    $("startBtn").textContent = "â–¶ï¸ Running";
    tickHandle = setInterval(updateUI, 200);
    updateUI();
  }

  function pause(){
    if(!running) return;
    running = false;
    elapsedAcc = getElapsedSec();
    clearInterval(tickHandle);
    tickHandle = null;
    $("startBtn").textContent = "â–¶ï¸ Start";
    updateUI();
  }

  function reset(){
    running = false;
    clearInterval(tickHandle);
    tickHandle = null;
    elapsedAcc = 0;
    $("startBtn").textContent = "â–¶ï¸ Start";
    $("barFill").style.width = "0%";
    renderStage(0);
    $("elapsedText").textContent = "0:00";
    $("timeText").textContent = mmss(totalSec);
    $("stepText").textContent = humanStep(stepSec());
  }

  function finish(){
    running = false;
    clearInterval(tickHandle);
    tickHandle = null;
    elapsedAcc = totalSec;
    updateUI();
    $("startBtn").textContent = "âœ… Done";
  }

  // ---------- Events ----------
  $("startBtn").addEventListener("click", () => {
    if(running) return;
    if(elapsedAcc >= totalSec) reset();
    start();
  });

  $("pauseBtn").addEventListener("click", () => {
    if(running) pause();
    else start();
  });

  $("resetBtn").addEventListener("click", reset);

  $("applyBtn").addEventListener("click", () => {
    const v = Number($("mins").value || 30);
    setTotalMinutes(v);
    reset();
  });

  window.addEventListener("keydown", (e) => {
    if(e.code === "Space"){
      e.preventDefault();
      if(running) pause(); else start();
    }
    if(e.key.toLowerCase() === "r"){
      reset();
    }
  });

  // ---------- Init ----------
  setTotalMinutes(30);
  reset();
})();
</script>
</body>
</html>
